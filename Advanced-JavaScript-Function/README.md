##### Table of content

- [Advanced JavaScript Function](#advanced-javascript-function)
  - [Default Parameters](#default-parameters)
  - [How Passing Arguments Works: Value vs Reference](#how-passing-arguments-works-value-vs-reference)
  - [First-Class and Higher-Order Functions](#first-class-and-higher-order-functions)
    - [Kh√°i ni·ªám](#kh√°i-ni·ªám)
    - [Functions Accepting Callback Functions](#functions-accepting-callback-functions)
    - [Functions Returning Functions](#functions-returning-functions)
  - [Function Methods: apply, call, bind](#function-methods-apply-call-bind)
    - [Call vs Apply](#call-vs-apply)
    - [Bind](#bind)
  - [Immediately Invoked Function Expressions (IIFE)](#immediately-invoked-function-expressions-iife)
  - [Closure](#closure)
    - [ƒê·ªãnh nghƒ©a](#ƒë·ªãnh-nghƒ©a)
    - [·ª®ng d·ª•ng](#·ª©ng-d·ª•ng)

# Advanced JavaScript Function

## Default Parameters

```
const bookings = [];
const createBooking = function (
  flightNum,
  numPassengers = 1,
  price = 199 * numPassengers
) {
  const booking = {
    flightNum,
    numPassengers,
    price,
  };
  console.log(booking);
  bookings.push(booking);
};

createBooking('LH123');
createBooking('LH123', 2, 800);
createBooking('LH123', 2);
createBooking('LH123', 5);
createBooking('LH123', undefined, 1000);
```

Tham kh·∫£o: [Default parameters](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Default_parameters)

## How Passing Arguments Works: Value vs Reference

- Khi ch√∫ng ta truy·ªÅn m·ªôt ƒë·ªëi s·ªë v√†o trong m·ªôt function trong JavaScript th√¨ ƒë√≥ s·∫Ω truy·ªÅn theo ki·ªÉu tham tr·ªã, t·ª©c l√† JavaScript s·∫Ω t·∫°o m·ªôt v√πng nh·ªõ m·ªõi trong callstack v√† copy gi√° tr·ªã c·ªßa bi·∫øn ƒë∆∞·ª£c truy·ªÅn v√†o cho v√πng nh·ªõ m·ªõi ƒë√≥.
- Do ƒë√≥ khi ch√∫ng ta ch√∫ng ta truy·ªÅn m·ªôt **primitive variable** (string, number, boolean,..) v√†o trong m·ªôt function th√¨ khi ch√∫ng ta c√≥ thay ƒë·ªïi ƒë·ªëi s·ªë ƒë√≥ trong function th√¨ **primitive variable** ·ªü b√™n ngo√†i s·∫Ω kh√¥ng b·ªã ·∫£nh h∆∞·ªüng.
- Tuy nhi√™n khi ch√∫ng ta truy·ªÅn v√†o m·ªôt **reference variable** (nh∆∞ object, function, array,...) th√¨ l·∫°i l√† m·ªôt c√¢u chuy·ªán kh√°c. V·ªÅ b·∫£n ch·∫•t JavaScript c≈©ng s·∫Ω t·∫°o m·ªôt v√πng nh·ªõ m·ªõi trong callstack v√† copy gi√° tr·ªã c·ªßa bi·∫øn ƒë∆∞·ª£c truy·ªÅn v√†o, tuy nhi√™n ƒë·ªëi v·ªõi ki·ªÉu d·ªØ li·ªáu **Object** th√¨ gi√° tr·ªã trong callstack s·∫Ω l√† ƒë·ªãa ch·ªâ v√πng nh·ªõ c·ªßa object ƒë√≥ trong heap, n√™n khi ch√∫ng ta thao t√°c v·ªõi ƒë·ªëi s·ªë trong function th√¨ c≈©ng t∆∞∆°ng t·ª± nh∆∞ ch√∫ng ta ƒëang thao t√°c v·ªõi object ƒë√≥ b√™n trong heap, do ƒë√≥ **reference variable** ·ªü b√™n ngo√†i c≈©ng s·∫Ω b·ªã ·∫£nh h∆∞·ªüng.

  ```
  const flight = 'LH234';
  const jonas = {
    name: 'Jonas Schmedtmann',
    passport: 24739479284,
  };
  const checkIn = function (flightNum, passenger) {
    flightNum = 'LH999';
    passenger.name = 'Mr. ' + passenger.name;
    if (passenger.passport === 24739479284) {
      alert('Checked in');
    } else {
      alert('Wrong passport!');
    }
  };
  // checkIn(flight, jonas);
  // console.log(flight);
  // console.log(jonas);
  // Is the same as doing...
  // const flightNum = flight;
  // const passenger = jonas;
  const newPassport = function (person) {
    person.passport = Math.trunc(Math.random() * 100000000000);
  };
  newPassport(jonas);
  checkIn(flight, jonas);
  ```

## First-Class and Higher-Order Functions

### Kh√°i ni·ªám

![](../Screenshots/Advanced-JS-Function/first-class-hoc.png)

- First-class Function ch·ªâ l√† m·ªôt kh√°i ni·ªám trong JavaScript, kh√°i ni·ªám ƒë√≥ m√¥ t·∫£ function t∆∞∆°ng t·ª± nh∆∞ m·ªôt gi√° tr·ªã.
- Higher-Order Function l√† m·ªôt function c√≥ ƒë·ªëi s·ªë truy·ªÅn v√†o l√† m·ªôt function ho·∫∑c m·ªôt h√†m return m·ªôt function kh√°c.

### Functions Accepting Callback Functions

```
const oneWord = function (str) {
  return str.replace(/ /g, '').toLowerCase();
};
const upperFirstWord = function (str) {
  const [first, ...others] = str.split(' ');
  return [first.toUpperCase(), ...others].join(' ');
};

// Higher-order function
const transformer = function (str, fn) {
  console.log(`Original string: ${str}`);
  console.log(`Transformed string: ${fn(str)}`);
  console.log(`Transformed by: ${fn.name}`);
};
transformer('JavaScript is the best!', upperFirstWord);
transformer('JavaScript is the best!', oneWord);

// JS uses callbacks all the time
const high5 = function () {
  console.log('üëã');
};
document.body.addEventListener('click', high5);
['Jonas', 'Martha', 'Adam'].forEach(high5);
```

### Functions Returning Functions

```
const greet = function (greeting) {
  return function (name) {
    console.log(`${greeting} ${name}`);
  };
};
const greeterHey = greet('Hey');
greeterHey('Jonas');
greeterHey('Steven');
greet('Hello')('Jonas');

const greetArr = greeting => name => console.log(`${greeting} ${name}`);
greetArr('Hi')('Jonas');
```

## Function Methods: apply, call, bind

Ph∆∞∆°ng th·ª©c `apply`, `call` v√† `bind` ƒë·ªÅu c√≥ chung m·ªôt nhi·ªám v·ª• l√† ƒë·ªãnh nghƒ©a context c·ªßa t·ª´ kh√≥a _this_ b√™n trong c√°c function, t·ª©c l√† ch√∫ng ta s·∫Ω ƒë·ªãnh nghƒ©a ƒë·ªëi t∆∞·ª£ng m√† t·ª´ kh√≥a _this_ tr·ªè t·ªõi.

### Call vs Apply

- C·∫£ hai ph∆∞∆°ng th·ª©c `call` v√† `apply` ƒë·ªÅu ƒë∆∞·ª£c s·ª≠ d·ª•ng v·ªõi chung m·ª•c ƒë√≠ch l√† ƒë·ªÉ g·ªçi th·ª±c thi h√†m, ƒë·ªìng th·ªùi c≈©ng ch·ªâ ƒë·ªãnh ƒë·ªëi t∆∞·ª£ng m√† t·ª´ kh√≥a this tr·ªè t·ªõi khi th·ª±c thi h√†m.
- ƒêi·ªÉm kh√°c nhau gi·ªØa hai ph∆∞∆°ng th·ª©c l√† `apply` s·∫Ω truy·ªÅn 1 m·∫£ng c√°c tham s·ªë c√≤n `call` s·∫Ω truy·ªÅn l·∫ßn l∆∞·ªõt c√°c tham s·ªë.
- M·ªôt ƒëi·ªÅu l∆∞u √Ω l√† tham s·ªë ƒë·∫ßu ti√™n l√∫c n√†o c≈©ng l√† ƒë·ªëi t∆∞·ª£ng ƒë·ªÉ t·ª´ kh√≥a this tr·ªè t·ªõi, c√°c tham s·ªë c√≤n l·∫°i l√† c√°c ƒë·ªëi s·ªë truy·ªÅn v√†o.
- C√∫ ph√°p:

  ```
  call()
  Function.prototype.call(thisArg[, arg1[ , arg2, ‚Ä¶]])
  apply()
  Function.prototype.apply(thisArg, argArray)
  ```

- V√≠ d·ª•:

  ```
  const lufthansa = {
    airline: 'Lufthansa',
    iataCode: 'LH',
    bookings: [],
    // book: function() {}
    book(flightNum, name) {
      console.log(
        `${name} booked a seat on ${this.airline} flight ${this.iataCode}${flightNum}`
      );
      this.bookings.push({ flight: `${this.iataCode}${flightNum}`, name });
    },
  };

  const eurowings = {
    airline: 'Eurowings',
    iataCode: 'EW',
    bookings: [],
  };

  const swiss = {
    airline: 'Swiss Air Lines',
    iataCode: 'LX',
    bookings: [],
  };

  lufthansa.book(239, 'Jonas Schmedtmann');
  lufthansa.book(635, 'John Smith');

  const book = lufthansa.book;
  // Does NOT work
  // book(23, 'Sarah Williams');

  // Call method
  book.call(eurowings, 23, 'Sarah Williams');
  console.log(eurowings);

  book.call(lufthansa, 239, 'Mary Cooper');
  console.log(lufthansa);

  book.call(swiss, 583, 'Mary Cooper');

  // Apply method
  const flightData = [583, 'George Cooper'];

  book.apply(swiss, flightData);
  console.log(swiss);

  book.call(swiss, ...flightData);
  ```

### Bind

- Kh√°c v·ªõi hai ph∆∞∆°ng th·ª©c `call` v√† `apply`, ph∆∞∆°ng th·ª©c `bind` s·∫Ω tr·∫£ v·ªÅ m·ªôt h√†m ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a ƒë·ªëi t∆∞·ª£ng c·ª• th·ªÉ s·∫Ω b·ªã r√†ng bu·ªôc cho con tr·ªè _this_.
- Ngo√†i vi·ªác r√†ng bu·ªôc v·ªõi con tr·ªè _this_, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c `bind` ƒë·ªÉ l√†m Partial Application (set c·ª©ng c√°c ƒë·ªëi s·ªë c·ª• th·ªÉ).

  ```
  const lufthansa = {
    airline: 'Lufthansa',
    iataCode: 'LH',
    bookings: [],
    // book: function() {}
    book(flightNum, name) {
      console.log(
        `${name} booked a seat on ${this.airline} flight ${this.iataCode}${flightNum}`
      );
      this.bookings.push({ flight: `${this.iataCode}${flightNum}`, name });
    },
  };

  const eurowings = {
    airline: 'Eurowings',
    iataCode: 'EW',
    bookings: [],
  };

  const swiss = {
    airline: 'Swiss Air Lines',
    iataCode: 'LX',
    bookings: [],
  };

  const book = lufthansa.book;

  const bookEW = book.bind(eurowings);
  const bookLH = book.bind(lufthansa);
  const bookLX = book.bind(swiss);

  bookEW(23, 'Steven Williams');

  const bookEW23 = book.bind(eurowings, 23);
  bookEW23('Jonas Schmedtmann');
  bookEW23('Martha Cooper');

  // With Event Listeners
  lufthansa.planes = 300;
  lufthansa.buyPlane = function () {
    console.log(this);
    this.planes++;
    console.log(this.planes);
  };
  document
    .querySelector('.buy')
    .addEventListener('click', lufthansa.buyPlane.bind(lufthansa));

  // Partial application
  const addTax = (rate, value) => value + value * rate;
  console.log(addTax(0.1, 200));

  const addVAT = addTax.bind(null, 0.23);
  // addVAT = value => value + value * 0.23;

  console.log(addVAT(100));
  console.log(addVAT(23));

  const addTaxRate = function (rate) {
    return function (value) {
      return value + value * rate;
    };
  };
  const addVAT2 = addTaxRate(0.23);
  console.log(addVAT2(100));
  console.log(addVAT2(23));
  ```

Tham kh·∫£o: [Bind, Apply and Call trong javascript](https://viblo.asia/p/bind-apply-and-call-trong-javascript-DzVGpoMDvnW)

## Immediately Invoked Function Expressions (IIFE)

```
const runOnce = function () {
  console.log('This will never run again');
};
runOnce();
// IIFE
(function () {
  console.log('This will never run again');
  const isPrivate = 23;
})();
// console.log(isPrivate);
(() => console.log('This will ALSO never run again'))();
{
  const isPrivate = 23;
  var notPrivate = 46;
}
// console.log(isPrivate);
console.log(notPrivate);
```

Tham kh·∫£o: [IIFE](https://developer.mozilla.org/en-US/docs/Glossary/IIFE)

## Closure

### ƒê·ªãnh nghƒ©a

![](../Screenshots/Advanced-JS-Function/closure.png)

```
const secureBooking = function () {
  let passengerCount = 0;
  return function () {
    passengerCount++;
    console.log(`${passengerCount} passengers`);
  };
};
const booker = secureBooking();
```

![](../Screenshots/Advanced-JS-Function/closure-2.png)

```
booker(); // 1 passengers
booker(); // 2 passengers
booker(); // 3 passengers
```

![](../Screenshots/Advanced-JS-Function/closure-3.png)

![](../Screenshots/Advanced-JS-Function/closure-4.png)

- Ch√∫ng ta c√≥ th·ªÉ t·∫°o ra closure m√† kh√¥ng c·∫ßn thi·∫øt ph·∫£i return v·ªÅ m·ªôt h√†m:

  ```
  let f;
  const g = function () {
    const a = 23;
    f = function () {
      console.log(a * 2);
    };
  };

  const h = function () {
    const b = 777;
    f = function () {
      console.log(b * 2);
    };
  };

  g();
  f();
  console.dir(f);

  // Re-assigning f function
  h();
  f();
  console.dir(f);
  ```

- Ngo√†i ra ch√∫ng ta c√≥ th·ªÉ t·∫°o closure th√¥ng qua **Timer**:

  ```
  const boardPassengers = function (n, wait) {
    const perGroup = n / 3;
    setTimeout(function () {
      console.log(`We are now boarding all ${n} passengers`);
      console.log(`There are 3 groups, each with ${perGroup} passengers`);
    }, wait * 1000);
    console.log(`Will start boarding in ${wait} seconds`);
  };

  const perGroup = 1000; // Do closure c√≥ ƒë·ªô ∆∞u ti√™n cao h∆°n scope chain n√™n c√°c bi·∫øn b√™n trong callback c·ªßa setTimeout kh√¥ng truy c·∫≠p v√†o global variable ·ªü b√™n ngo√†i tr∆∞·ªõc
  boardPassengers(180, 3);
  ```

Tham kh·∫£o:

1. [Closures](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures)
2. [JavaScript Closures](https://viblo.asia/p/javascript-closures-PdbknoZLvyA)

### ·ª®ng d·ª•ng

Ch√∫ng ta c√≥ th·ªÉ ·ª©ng d·ª•ng closure trong r·∫•t nhi·ªÅu tr∆∞·ªùng h·ª£p, sau ƒë√¢y s·∫Ω l√† 2 v√≠ d·ª• v·ªÅ ·ª©ng d·ª•ng closure:

1. ·ª®ng d·ª•ng closure ƒë·ªÉ t·∫°o Logger

```
const createLogger = (prefix) => (message) =>
  console.log(`[${[prefix]}]\t${message}`);

const infoLogger = createLogger("INFO");
infoLogger("ƒêang x·ª≠ l√Ω l·ªói.");

const errorLogger = createLogger("ERROR");
errorLogger('Bi·∫øn "variable" ch∆∞a ƒë∆∞·ª£c kh·ªüi t·∫°o.');
```

2. ·ª®ng d·ª•ng closure ƒë·ªÉ truy xu·∫•t d·ªØ li·ªáu trong Local Storage

```
const createStorage = (key) => {
  const store = JSON.parse(localStorage.getItem(key)) ?? {};

  const save = () => localStorage.setItem(key, JSON.stringify(store));

  return {
    get(key) {
      return store[key];
    },
    set(key, value) {
      store[key] = value;
      save();
    },
    remove(key) {
      delete store[key];
      save();
    },
  };
};

const profileSetting = createStorage("profile_setting");
profileSetting.set("fullName", "Nhan Phan");
profileSetting.set("age", 22);
profileSetting.set("gender", "male");
console.log(profileSetting.get("fullName"));

const studentSetting = createStorage("student_setting");
studentSetting.set("fullName", "Thanh Nhan");
studentSetting.set("studentID", 19521943);
studentSetting.set("department", "Computer Science");
studentSetting.remove("department");
console.log(studentSetting.get("studentID"));
```
